<view class="container">
  <!-- åˆ†ç±»æ ‡ç­¾æ  -->
  <scroll-view class="category-bar" scroll-x enable-flex>
    <view class="category-item {{currentCategory === 'all' ? 'active' : ''}}" 
          bindtap="switchCategory" data-category="all">
      å…¨éƒ¨ç¬”è®°
    </view>
    <view class="category-item {{currentCategory === item._id ? 'active' : ''}}" 
          wx:for="{{categories}}" 
          wx:key="_id"
          bindtap="switchCategory" 
          data-category="{{item._id}}">
      {{item.name}}
      <text class="delete-icon" 
            catchtap="deleteCategory" 
            data-id="{{item._id}}" 
            data-name="{{item.name}}">Ã—</text>
    </view>
    <view class="category-item add" bindtap="showCategoryModal">
      <text class="add-icon">+</text>
    </view>
  </scroll-view>

  <!-- æ ‡ç­¾ç­›é€‰åŒº -->
  <view class="tag-filter">
    <scroll-view class="tag-scroll" scroll-x enable-flex>
      <view class="tag {{selectedTags.includes(item) ? 'active' : ''}}"
            wx:for="{{tags}}" 
            wx:key="*this"
            bindtap="toggleTag" 
            data-tag="{{item}}">
        #{{item}}
        <text class="delete-icon" 
              catchtap="deleteTag" 
              data-tag="{{item}}">Ã—</text>
      </view>
    </scroll-view>
  </view>

  <!-- ç¬”è®°åˆ—è¡¨ -->
  <scroll-view class="note-list" scroll-y>
    <view class="note-item" 
          wx:for="{{filteredNotes}}" 
          wx:key="_id"
          bindtap="navigateToDetail" 
          data-id="{{item._id}}">
      <view class="note-header">
        <text class="note-category">{{item.categoryName}}</text>
        <text class="note-date">{{item.createTimeFormatted}}</text>
      </view>
      <view class="note-content">{{item.content}}</view>
      <view class="note-footer">
        <view class="tag-list">
          <text class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">#{{tag}}</text>
        </view>
        <view class="note-task" wx:if="{{item.taskId}}">
          <text class="task-icon">ğŸ“‹</text>
          <text class="task-title">{{item.taskTitle}}</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- æ–°å»ºç¬”è®°æŒ‰é’® -->
  <view class="add-button" bindtap="navigateToCreate">
    <text class="add-icon">+</text>
  </view>

  <!-- æ–°å»ºåˆ†ç±»å¼¹çª— -->
  <view class="modal" wx:if="{{showCategoryModal}}">
    <view class="modal-content">
      <view class="modal-header">æ–°å»ºåˆ†ç±»</view>
      <input class="modal-input" 
             value="{{newCategory}}" 
             bindinput="onCategoryInput"
             placeholder="è¯·è¾“å…¥åˆ†ç±»åç§°"/>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="cancelCategory">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="saveCategory">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view> 