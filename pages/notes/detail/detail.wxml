<view class="container">
  <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
  <view class="header">
    <view class="header-info">
      <view class="category-tag">{{note.categoryName}}</view>
      <view class="date-info">
        <text class="date-label">åˆ›å»ºäº</text>
        <text class="date">{{note.createTimeFormatted}}</text>
      </view>
    </view>
  </view>

  <!-- ç¼–è¾‘æ¨¡å¼ -->
  <block wx:if="{{isEditing}}">
    <view class="edit-section">
      <!-- åˆ†ç±»é€‰æ‹© -->
      <view class="form-group">
        <text class="label">åˆ†ç±»</text>
        <scroll-view class="category-scroll" scroll-x enable-flex>
          <view class="category-item {{editData.categoryId === item._id ? 'active' : ''}}"
                wx:for="{{categories}}" 
                wx:key="_id"
                bindtap="selectCategory" 
                data-id="{{item._id}}">
            {{item.name}}
          </view>
        </scroll-view>
      </view>

      <!-- å†…å®¹ç¼–è¾‘ -->
      <view class="form-group">
        <text class="label">å†…å®¹</text>
        <textarea class="content-input" 
                  value="{{editData.content}}"
                  bindinput="onContentInput"
                  maxlength="1000"
                  placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•..."/>
        <text class="word-count">{{contentLength}}/1000</text>
      </view>

      <!-- æ ‡ç­¾ç¼–è¾‘ -->
      <view class="form-group">
        <text class="label">æ ‡ç­¾</text>
        <view class="tag-input-container">
          <view class="tag-list">
            <view class="tag-item" 
                  wx:for="{{editData.tags}}" 
                  wx:key="*this">
              <text class="tag-text">#{{item}}</text>
              <text class="tag-delete" 
                    catchtap="deleteTag" 
                    data-index="{{index}}">Ã—</text>
            </view>
          </view>
          <input class="tag-input" 
                 placeholder="è¾“å…¥æ ‡ç­¾æŒ‰å›è½¦æ·»åŠ " 
                 value="{{newTag}}"
                 bindconfirm="addTag"
                 bindinput="onTagInput"/>
        </view>
      </view>

      <!-- ç¼–è¾‘æŒ‰é’®ç»„ -->
      <view class="button-group">
        <button class="btn btn-cancel" bindtap="cancelEdit">å–æ¶ˆ</button>
        <button class="btn btn-save" bindtap="saveEdit">ä¿å­˜</button>
      </view>
    </view>
  </block>

  <!-- æŸ¥çœ‹æ¨¡å¼ -->
  <block wx:else>
    <view class="content-section">
      <!-- ç¬”è®°å†…å®¹ -->
      <view class="content-card">
        <text class="content">{{note.content}}</text>
      </view>
      
      <!-- æ ‡ç­¾åˆ—è¡¨ -->
      <view class="tags-section" wx:if="{{note.tags.length > 0}}">
        <text class="tag" wx:for="{{note.tags}}" wx:key="*this">#{{item}}</text>
      </view>

      <!-- å…³è”ä»»åŠ¡ -->
      <view class="related-task" wx:if="{{note.taskId}}" bindtap="navigateToTask">
        <view class="task-card">
          <text class="task-icon">ğŸ“‹</text>
          <view class="task-info">
            <text class="task-title">{{note.taskTitle}}</text>
            <text class="task-hint">ç‚¹å‡»æŸ¥çœ‹å…³è”ä»»åŠ¡</text>
          </view>
          <text class="arrow-icon">â€º</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="footer-actions">
      <button class="action-button edit" bindtap="toggleEdit">
        <text class="action-icon">âœ</text>
        <text class="action-text">ç¼–è¾‘ç¬”è®°</text>
      </button>
      <button class="action-button delete" bindtap="deleteNote">
        <text class="action-icon">ğŸ—‘</text>
        <text class="action-text">åˆ é™¤ç¬”è®°</text>
      </button>
    </view>
  </block>
</view> 